<!DOCTYPE html>
<html>
<head>
	<title>My Superhero App</title>
    <script src="https://kit.fontawesome.com/b962e18856.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" type="text/css" href="./superhero.css">
<meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body>
	<center>
		<h1 style="font-family: sans-serif;margin-top: 50px;">SUPERHERO HUNTER</h1>
		<div id="upper-div" class="header">
  
  <input type="text" id="myInput" placeholder="Search Name......">
  <span onclick="newSearch()" class="addBtn">Search</span>
  
</div>
<div id="image-container" style="margin-bottom: 30px;">
	<a href="./superheropage.html"><img id="superhero-image" style=" box-shadow: -1rem 0.3rem 3rem grey;"></a>
	<div id="add-to-favorite">
		<a href="#add-to-favorite" onclick="addHero()" class="button">Add to favorites</a>
	</div>
	<div id="my-favorites">
		<a href="./favouritehero_page.html" class="button">My favorites</a>
	</div>
</div>

	</center>
	
	<script type="text/javascript">
        var superhero_array=[];
		var superhero_array_element="error";
		var element_to_be_added="error";

    function newSearch(){
     var inputValue = document.getElementById("myInput").value;
     var xhrRequest=new XMLHttpRequest();
     xhrRequest.onload= function(){
     	console.log(xhrRequest.response);
     	var responseJSON=JSON.parse(xhrRequest.response);
     	var check=responseJSON.response;
     	if(check=='error'){
          alert("You must write a valid superhero!");
     	}
     	else{
     		superhero_array_element=inputValue;
     		element_to_be_added=inputValue;
           var x=responseJSON.results;
           var len=x.length;
           var imageUrl=x[len-1].image.url;
           if (typeof(Storage) !== "undefined"){
           localStorage.setItem("superhero-name", inputValue);
           console.log("does support");
           
       }
           else{
           	console.log("does not support");
           }
           document.getElementById("superhero-image").style.height = "400px";
           document.getElementById("superhero-image").style.width = "300px";
           document.getElementById("add-to-favorite").style.visibility="visible";
           document.getElementById("my-favorites").style.visibility="visible";
           document.getElementById("superhero-image").setAttribute("src",imageUrl);
     	}
     };
     var string="https://superheroapi.com/api.php/3076078909145759/search/"+inputValue;
     xhrRequest.open('get',string);
     xhrRequest.send();
    }
   
   function addHero(){
   	   if(element_to_be_added=="error"){
   	   	alert("Invalid request");
   	   }
   	   else{
   	   	localStorage.setItem("element_to_be_added",element_to_be_added);
   	   }
   	        if(superhero_array_element=="error"){
   	        	alert("Not Valid");
   	        }
   	        else{
   	        	
   	        	if (localStorage.getItem("superhero_array") === null) {
   	        		superhero_array.push(superhero_array_element);
               localStorage.setItem("superhero_array", JSON.stringify(superhero_array)); 
                 }
   	        	else{

   	        		var retrievedData = localStorage.getItem("superhero_array");
   	        		var temp_array = JSON.parse(retrievedData);
   	        		// console.log(retrievedData);
   	        		var check=0;
   	        		for(var i=0;i<temp_array.length;i++){
   	        			if(temp_array[i]===superhero_array_element){
   	        				check=1;break;
   	        			}
   	        		}
   	        		if(check===0){
                    temp_array.push(superhero_array_element);}
                    else{
                    	alert("Already Added");
                    }
                  localStorage.setItem("superhero_array", JSON.stringify(temp_array));  

   	        	}
   	        	console.log(localStorage.getItem("superhero_array"));
           	
           }
           }
    
	</script>
</body>
</html>